[
  {
    "sql": [
      "CREATE TYPE \"public\".\"datasource_status\" AS ENUM('draft', 'active', 'disabled');",
      "\nCREATE TYPE \"public\".\"datasource_type\" AS ENUM('mysql', 'clickhouse', 'postgres', 'doris', 'sqlite', 'pglite');",
      "\nCREATE TABLE \"tabs\" (\n\t\"tab_id\" text PRIMARY KEY NOT NULL,\n\t\"tab_type\" text DEFAULT 'sql' NOT NULL,\n\t\"tab_name\" text DEFAULT 'New Query' NOT NULL,\n\t\"user_id\" text NOT NULL,\n\t\"connection_id\" text NOT NULL,\n\t\"database_name\" text,\n\t\"table_name\" text,\n\t\"active_sub_tab\" text DEFAULT 'data' NOT NULL,\n\t\"content\" text DEFAULT '' NOT NULL,\n\t\"state\" text,\n\t\"result_meta\" text,\n\t\"order_index\" integer DEFAULT 0 NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"account\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"account_id\" text NOT NULL,\n\t\"provider_id\" text NOT NULL,\n\t\"user_id\" text NOT NULL,\n\t\"access_token\" text,\n\t\"refresh_token\" text,\n\t\"id_token\" text,\n\t\"access_token_expires_at\" timestamp with time zone,\n\t\"refresh_token_expires_at\" timestamp with time zone,\n\t\"scope\" text,\n\t\"password\" text,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"jwks\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"alg\" text,\n\t\"crv\" text,\n\t\"public_key\" text NOT NULL,\n\t\"private_key\" text NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"expires_at\" timestamp with time zone\n);\n",
      "\nCREATE TABLE \"session\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"expires_at\" timestamp with time zone NOT NULL,\n\t\"token\" text NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"ip_address\" text,\n\t\"user_agent\" text,\n\t\"user_id\" text NOT NULL,\n\tCONSTRAINT \"session_token_unique\" UNIQUE(\"token\")\n);\n",
      "\nCREATE TABLE \"user\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"email\" text NOT NULL,\n\t\"default_team_id\" text,\n\t\"email_verified\" boolean NOT NULL,\n\t\"image\" text,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\tCONSTRAINT \"user_email_unique\" UNIQUE(\"email\")\n);\n",
      "\nCREATE TABLE \"verification\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"identifier\" text NOT NULL,\n\t\"value\" text NOT NULL,\n\t\"expires_at\" timestamp with time zone NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"chat_messages\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"session_id\" text NOT NULL,\n\t\"user_id\" text,\n\t\"connection_id\" text,\n\t\"role\" text NOT NULL,\n\t\"parts\" jsonb NOT NULL,\n\t\"metadata\" jsonb,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"chat_session_state\" (\n\t\"session_id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"connection_id\" text,\n\t\"active_tab_id\" text,\n\t\"active_database\" text,\n\t\"active_schema\" text,\n\t\"editor_context\" jsonb,\n\t\"last_run_summary\" jsonb,\n\t\"stable_context\" jsonb,\n\t\"revision\" integer DEFAULT 0 NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL\n);\n",
      "\nCREATE TABLE \"chat_sessions\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"user_id\" text NOT NULL,\n\t\"type\" text DEFAULT 'copilot' NOT NULL,\n\t\"tab_id\" text,\n\t\"connection_id\" text,\n\t\"active_database\" text,\n\t\"active_schema\" text,\n\t\"title\" text,\n\t\"settings\" jsonb,\n\t\"metadata\" jsonb,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL,\n\t\"archived_at\" timestamp with time zone,\n\t\"last_message_at\" timestamp with time zone,\n\tCONSTRAINT \"uq_chat_sessions_id_team\" UNIQUE(\"id\",\"team_id\"),\n\tCONSTRAINT \"ck_chat_sessions_type_tab\" CHECK (((\"chat_sessions\".\"type\" = 'copilot' AND \"chat_sessions\".\"tab_id\" IS NOT NULL) OR (\"chat_sessions\".\"type\" <> 'copilot' AND \"chat_sessions\".\"tab_id\" IS NULL)))\n);\n",
      "\nCREATE TABLE \"query_audit\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"tab_id\" text,\n\t\"user_id\" text NOT NULL,\n\t\"source\" text NOT NULL,\n\t\"connection_id\" text,\n\t\"connection_name\" text,\n\t\"database_name\" text,\n\t\"query_id\" text,\n\t\"sql_text\" text NOT NULL,\n\t\"status\" text NOT NULL,\n\t\"error_message\" text,\n\t\"duration_ms\" integer,\n\t\"rows_read\" integer,\n\t\"bytes_read\" integer,\n\t\"rows_written\" integer,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"extra_json\" jsonb\n);\n",
      "\nCREATE TABLE \"team_members\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"user_id\" text NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"role\" text DEFAULT 'member' NOT NULL,\n\t\"status\" text DEFAULT 'active' NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"joined_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"teams\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"owner_user_id\" text NOT NULL,\n\t\"slug\" text,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"connection_identities\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"connection_id\" text NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"name\" text NOT NULL,\n\t\"username\" text NOT NULL,\n\t\"role\" text,\n\t\"options\" text DEFAULT '{}' NOT NULL,\n\t\"is_default\" boolean DEFAULT false NOT NULL,\n\t\"database\" text,\n\t\"enabled\" boolean DEFAULT true NOT NULL,\n\t\"status\" text DEFAULT 'active' NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL,\n\t\"deleted_at\" timestamp with time zone\n);\n",
      "\nCREATE TABLE \"connection_identity_secrets\" (\n\t\"identity_id\" text PRIMARY KEY NOT NULL,\n\t\"password_encrypted\" text,\n\t\"vault_ref\" text,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL\n);\n",
      "\nCREATE TABLE \"connection_ssh\" (\n\t\"connection_id\" text PRIMARY KEY NOT NULL,\n\t\"enabled\" boolean DEFAULT false NOT NULL,\n\t\"host\" text,\n\t\"port\" integer,\n\t\"username\" text,\n\t\"auth_method\" text,\n\t\"password_encrypted\" text,\n\t\"private_key_encrypted\" text,\n\t\"passphrase_encrypted\" text,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL,\n\tCONSTRAINT \"chk_connection_ssh_port\" CHECK (\"connection_ssh\".\"port\" IS NULL OR (\"connection_ssh\".\"port\" BETWEEN 1 AND 65535))\n);\n",
      "\nCREATE TABLE \"connections\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"created_by_user_id\" text,\n\t\"team_id\" text NOT NULL,\n\t\"type\" text NOT NULL,\n\t\"engine\" text NOT NULL,\n\t\"name\" text DEFAULT 'Untitled connection' NOT NULL,\n\t\"description\" text,\n\t\"host\" text NOT NULL,\n\t\"port\" integer NOT NULL,\n\t\"http_port\" integer,\n\t\"database\" text,\n\t\"options\" text DEFAULT '{}' NOT NULL,\n\t\"status\" text DEFAULT 'draft' NOT NULL,\n\t\"config_version\" integer DEFAULT 1 NOT NULL,\n\t\"validation_errors\" text DEFAULT '{}',\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone NOT NULL,\n\t\"deleted_at\" timestamp with time zone,\n\t\"last_used_at\" timestamp with time zone,\n\t\"last_check_status\" text DEFAULT 'unknown' NOT NULL,\n\t\"last_check_at\" timestamp with time zone,\n\t\"last_check_latency_ms\" integer,\n\t\"last_check_error\" text,\n\t\"environment\" text DEFAULT '',\n\t\"tags\" text DEFAULT '' NOT NULL,\n\tCONSTRAINT \"chk_connections_port\" CHECK (\"connections\".\"port\" IS NULL OR (\"connections\".\"port\" BETWEEN 1 AND 65535)),\n\tCONSTRAINT \"chk_connections_http_port\" CHECK (\"connections\".\"http_port\" IS NULL OR (\"connections\".\"http_port\" BETWEEN 1 AND 65535))\n);\n",
      "\nCREATE TABLE \"ai_schema_cache\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"connection_id\" text NOT NULL,\n\t\"catalog\" text DEFAULT 'default' NOT NULL,\n\t\"database_name\" text,\n\t\"table_name\" text,\n\t\"feature\" text NOT NULL,\n\t\"db_type\" text,\n\t\"schema_hash\" text NOT NULL,\n\t\"model\" text NOT NULL,\n\t\"prompt_version\" integer DEFAULT 1 NOT NULL,\n\t\"payload\" jsonb NOT NULL,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL\n);\n",
      "\nCREATE TABLE \"saved_queries\" (\n\t\"id\" text PRIMARY KEY NOT NULL,\n\t\"team_id\" text NOT NULL,\n\t\"user_id\" text NOT NULL,\n\t\"title\" text NOT NULL,\n\t\"description\" text,\n\t\"sql_text\" text NOT NULL,\n\t\"context\" jsonb DEFAULT '{}'::jsonb NOT NULL,\n\t\"tags\" text[] DEFAULT '{}'::text[] NOT NULL,\n\t\"work_id\" uuid,\n\t\"created_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"updated_at\" timestamp with time zone DEFAULT now() NOT NULL,\n\t\"archived_at\" timestamp with time zone\n);\n",
      "\nALTER TABLE \"tabs\" ADD CONSTRAINT \"tabs_user_id_user_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"tabs\" ADD CONSTRAINT \"tabs_connection_id_connections_id_fk\" FOREIGN KEY (\"connection_id\") REFERENCES \"public\".\"connections\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"account\" ADD CONSTRAINT \"account_user_id_user_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"session\" ADD CONSTRAINT \"session_user_id_user_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"user\" ADD CONSTRAINT \"user_default_team_id_teams_id_fk\" FOREIGN KEY (\"default_team_id\") REFERENCES \"public\".\"teams\"(\"id\") ON DELETE no action ON UPDATE no action;",
      "\nALTER TABLE \"query_audit\" ADD CONSTRAINT \"query_audit_connection_id_connections_id_fk\" FOREIGN KEY (\"connection_id\") REFERENCES \"public\".\"connections\"(\"id\") ON DELETE no action ON UPDATE no action;",
      "\nALTER TABLE \"team_members\" ADD CONSTRAINT \"team_members_user_id_user_id_fk\" FOREIGN KEY (\"user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"team_members\" ADD CONSTRAINT \"team_members_team_id_teams_id_fk\" FOREIGN KEY (\"team_id\") REFERENCES \"public\".\"teams\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"connection_identities\" ADD CONSTRAINT \"connection_identities_connection_id_connections_id_fk\" FOREIGN KEY (\"connection_id\") REFERENCES \"public\".\"connections\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"connection_identities\" ADD CONSTRAINT \"connection_identities_team_id_teams_id_fk\" FOREIGN KEY (\"team_id\") REFERENCES \"public\".\"teams\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"connection_identity_secrets\" ADD CONSTRAINT \"connection_identity_secrets_identity_id_connection_identities_id_fk\" FOREIGN KEY (\"identity_id\") REFERENCES \"public\".\"connection_identities\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"connection_ssh\" ADD CONSTRAINT \"connection_ssh_connection_id_connections_id_fk\" FOREIGN KEY (\"connection_id\") REFERENCES \"public\".\"connections\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nALTER TABLE \"connections\" ADD CONSTRAINT \"connections_created_by_user_id_user_id_fk\" FOREIGN KEY (\"created_by_user_id\") REFERENCES \"public\".\"user\"(\"id\") ON DELETE set null ON UPDATE no action;",
      "\nALTER TABLE \"connections\" ADD CONSTRAINT \"connections_team_id_teams_id_fk\" FOREIGN KEY (\"team_id\") REFERENCES \"public\".\"teams\"(\"id\") ON DELETE cascade ON UPDATE no action;",
      "\nCREATE INDEX \"idx_chat_messages_session_time\" ON \"chat_messages\" USING btree (\"team_id\",\"session_id\",\"created_at\");",
      "\nCREATE INDEX \"idx_chat_messages_session_id\" ON \"chat_messages\" USING btree (\"team_id\",\"session_id\",\"id\");",
      "\nCREATE INDEX \"idx_chat_messages_team_conn_time\" ON \"chat_messages\" USING btree (\"team_id\",\"connection_id\",\"created_at\");",
      "\nCREATE INDEX \"idx_chat_state_team_conn\" ON \"chat_session_state\" USING btree (\"team_id\",\"connection_id\");",
      "\nCREATE INDEX \"idx_chat_state_team_tab\" ON \"chat_session_state\" USING btree (\"team_id\",\"active_tab_id\");",
      "\nCREATE INDEX \"idx_chat_state_team_updated\" ON \"chat_session_state\" USING btree (\"team_id\",\"updated_at\");",
      "\nCREATE INDEX \"idx_chat_sessions_list\" ON \"chat_sessions\" USING btree (\"team_id\",\"user_id\",\"archived_at\",\"last_message_at\");",
      "\nCREATE INDEX \"idx_chat_sessions_team_user_type\" ON \"chat_sessions\" USING btree (\"team_id\",\"user_id\",\"type\");",
      "\nCREATE INDEX \"idx_chat_sessions_team_conn\" ON \"chat_sessions\" USING btree (\"team_id\",\"connection_id\");",
      "\nCREATE INDEX \"idx_chat_sessions_team_db\" ON \"chat_sessions\" USING btree (\"team_id\",\"active_database\");",
      "\nCREATE UNIQUE INDEX \"uidx_chat_sessions_copilot_tab\" ON \"chat_sessions\" USING btree (\"team_id\",\"user_id\",\"tab_id\") WHERE \"chat_sessions\".\"type\" = 'copilot';",
      "\nCREATE INDEX \"idx_team_created\" ON \"query_audit\" USING btree (\"team_id\",\"created_at\");",
      "\nCREATE INDEX \"idx_source_created\" ON \"query_audit\" USING btree (\"source\",\"created_at\");",
      "\nCREATE INDEX \"idx_query_id\" ON \"query_audit\" USING btree (\"query_id\");",
      "\nCREATE UNIQUE INDEX \"team_members_team_id_user_id_unique\" ON \"team_members\" USING btree (\"team_id\",\"user_id\");",
      "\nCREATE INDEX \"idx_team_members_team\" ON \"team_members\" USING btree (\"team_id\");",
      "\nCREATE INDEX \"idx_team_members_user\" ON \"team_members\" USING btree (\"user_id\");",
      "\nCREATE UNIQUE INDEX \"teams_slug_unique\" ON \"teams\" USING btree (\"slug\");",
      "\nCREATE UNIQUE INDEX \"uniq_conn_identity_connection_name\" ON \"connection_identities\" USING btree (\"connection_id\",\"name\") WHERE \"connection_identities\".\"deleted_at\" IS NULL;",
      "\nCREATE UNIQUE INDEX \"uniq_conn_identity_default_per_connection\" ON \"connection_identities\" USING btree (\"connection_id\") WHERE \"connection_identities\".\"is_default\" = true;",
      "\nCREATE INDEX \"idx_conn_identity_connection_id\" ON \"connection_identities\" USING btree (\"connection_id\");",
      "\nCREATE INDEX \"idx_conn_identity_team_id\" ON \"connection_identities\" USING btree (\"team_id\");",
      "\nCREATE INDEX \"idx_conn_identity_enabled\" ON \"connection_identities\" USING btree (\"enabled\");",
      "\nCREATE UNIQUE INDEX \"uniq_connections_team_name\" ON \"connections\" USING btree (\"team_id\",\"name\") WHERE \"connections\".\"deleted_at\" IS NULL;",
      "\nCREATE INDEX \"idx_connections_team_id_status\" ON \"connections\" USING btree (\"team_id\",\"status\");",
      "\nCREATE INDEX \"idx_connections_created_by_user_id\" ON \"connections\" USING btree (\"created_by_user_id\");",
      "\nCREATE INDEX \"idx_connections_team_env\" ON \"connections\" USING btree (\"team_id\",\"environment\");",
      "\nCREATE UNIQUE INDEX \"uniq_ai_cache_team_conn_catalog_feature_schema_model_prompt\" ON \"ai_schema_cache\" USING btree (\"team_id\",\"connection_id\",\"catalog\",\"feature\",\"schema_hash\",\"model\",\"prompt_version\");",
      "\nCREATE INDEX \"idx_ai_cache_team_conn\" ON \"ai_schema_cache\" USING btree (\"team_id\",\"connection_id\");",
      "\nCREATE INDEX \"idx_ai_cache_catalog_db_table\" ON \"ai_schema_cache\" USING btree (\"catalog\",\"database_name\",\"table_name\");",
      "\nCREATE INDEX \"idx_ai_cache_schema_hash\" ON \"ai_schema_cache\" USING btree (\"schema_hash\");",
      "\nCREATE INDEX \"idx_saved_queries_team_user\" ON \"saved_queries\" USING btree (\"team_id\",\"user_id\");",
      "\nCREATE INDEX \"idx_saved_queries_updated_at\" ON \"saved_queries\" USING btree (\"updated_at\");"
    ],
    "bps": true,
    "folderMillis": 1769399999558,
    "hash": "c69f1505d25eaa4591bcd6838478ac11b93285a84e2c708f29f1b01a7db76a86"
  }
]